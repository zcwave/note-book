# 本章小结

在本章，你已经学习了如何使用＜string＞类库，利用该类库你可以编写出字符串操作函数，并且不用担心底层表示的细节问题。本章的重点包括：

- ＜string＞类库提供了一个string类，它用于代表一个字符序列。尽管Cpp语言也包括一个更原始的类型去维护对于C语言的兼容性，但在编写程序时最好使用string类。

- 如果你使用>>提取操作符读取字符串数据，输入将会在第一个空白字符处停止。如果你想从用户那里读取一整行文本，使用C＋＋标准库提供的getline函数会更好。

- string类中提供的最常用方法显示在表3—1中。因为string是一个类，方法都使用接收方语法来代替传统的函数形式。因此，为了获取存储在str变量中字符串的长度，你需要调用str.length（）。

- ·string类提供的几种方法破坏性地修改了接收字符串。给予用户自由的权限去使用这些能够改变一个对象内部状态的方法，这使得对象的完整性更难以保护。因此，本书中的程序将最大限度地减少这些方法的使用。

- **string类使用操作符重载以简化许多常见的字符串操作。对于字符串来说，最重要的操作符是＋（连接）操作符、［］（选择）操作符和关系操作符。**

- 循环遍历一个字符串中字符的标准模式是：

  ```cpp
  for (int i = 0;i < str.length();i++) {
  	body of loop that manipulates str[i]...
  }
  
  for (auto i : str) {
  	body of loop that manipulates str[i]...
  }
  ```

- ＜cctype＞库提供了几种处理单个字符的函数。其中最重要的函数显示在表3—2中。

- 通过连接以增长一个字符串的标准模式是：

  ```cpp
  string str="";
  
  for (whatever loop header line fits the application){ 
      str += the next substring or character; 
  }
  ```

# 字符串的常见操作与cctype库（对单个字符的操作）

![image-20240131044422058](http://zcwave.oss-cn-qingdao.aliyuncs.com/image/image-20240131044422058.png)

![image-20240131044428971](http://zcwave.oss-cn-qingdao.aliyuncs.com/image/image-20240131044428971.png)

![image-20240131044435751](http://zcwave.oss-cn-qingdao.aliyuncs.com/image/image-20240131044435751.png)

## 提取字符串中的子串

在连接较短字符串以形成更长的字符串运算后，你经常需要先做相反的工作：将一个字符串分解成数个短片段。一个较长字符串的一部分称为其子串（substring）。

string类提供了一个带有两个参数的方法substr，**其中第一个参数为提取字符串子串的起始位置，第二个参数为欲提取的子串字符个数。**

- 调用函数str.substr（start，n），将从start指定的索引位置开始在str中提取一个n个字符的子串。例如，如果str包含字符串＂hello，world”，调用如下方法：

  `str.substr(1,3)`

  将返回包含3个字符的子串“ell”。由于C++中的下标从0开始，在索引位置1处为字符`e`。

- 在substr方法中第二个参数是可选的，如果第二个参数省略，substr返回一个从指定位置开始持续到该字符串结尾的子串。因此，如以下调用方法：

  `str.substr(7)`

  将返回字符串＂world＂。

- 类似地，如果n是已知的，但指定的开始位置后面少于n个字符，substr只返回原始字符串指定位置到字符串结尾的子串。


下面的函数调用将返回参数str的后半段子串，如果str的长度为奇数，则其子串将包含最中间的字符。

```cpp
string secondHalf(string str) {
    return str.substr(str.length() / 2);
}
```

```cpp
#include <iostream>
#include <string>
 
int main()
{
    std::string a = "0123456789abcdefghij";
 
    // count is npos, returns [pos, size())
    std::string sub1 = a.substr(10);
    std::cout << sub1 << '\n';
 
    // both pos and pos + count are within bounds, returns [pos, pos + count)
    std::string sub2 = a.substr(5, 3);
    std::cout << sub2 << '\n';
 
    // pos is within bounds, pos + count is not, returns [pos, size())
    std::string sub4 = a.substr(a.size() - 3, 50);
    // this is effectively equivalent to
    // std::string sub4 = a.substr(17, 3);
    // since a.size() == 20, pos == a.size() - 3 == 17, and a.size() - pos == 3
 
    std::cout << sub4 << '\n';
 
    try
    {
        // pos is out of bounds, throws
        std::string sub5 = a.substr(a.size() + 3, 50);
        std::cout << sub5 << '\n';
    }
    catch (const std::out_of_range& ex)
    {
        std::cout << ex.what() << '\n';
    }
}
```

可能的输出如下：

```cpp
abcdefghij
567
hij
basic_string::substr: __pos (which is 23) > this->size() (which is 20)
```

## `cctype`：C Character Type Library.

由于字符串是由字符组成的，处理字符串中的单个字符而不是整个字符串的操作就显得非常必要。

`<cctype>`库提供了处理字符串中字符的各种函数，其中最常见的函数如表3—2所示。

![image-20240131044643004](http://zcwave.oss-cn-qingdao.aliyuncs.com/image/image-20240131044643004.png)

## 遗留的C风格字符串

`string str = "hello" + "," + "world";`

是不可以的， 在拼接操作符的两边必须有一方是C++ string，不可以都是字符串字面值。

# 编写字符串应用程序 ♥♥

## 回文识别

回文（palindrome）是指其字母排列正序与倒序均一致的词语，例如单词“level”或“noon”。

本节的目的是编写一个判断函数以检测一个字符串是否属于回文。调用isPalindrome（＂level＂）应该返回 true；调用isPalindrome（＂xyz＂）应返回 false。 

```cpp
bool isPalindrome(string str){
    int len = str.length();
    for (int i = 0; i < len/2; i++){
        if (str[i] != str[len - i - 1])
            return false;
    }
    return true;
}
```

一个更简洁的实现是使用reverse()

```cpp
bood isPalindrome(string str){
	return str == reverse(str);
}
```

读起来几乎和英语一样流畅：如果一个字符串和它相反顺序的字符串相等，则它是一个回文。

尤其是当你正在学习编程时，致力于程序的简洁性比关注其执行效率更为重要。鉴于现在计算机的速度，牺牲几个机器周期来使程序更易于理解是值得的。

## 将英语翻译成儿童黑话

为了使你更多地了解如何实现对字符串操作的应用，本节列举了一个 C++ 程序，它读取用户输入的一行文字，然后将这行文字的每个单词从英语翻译成儿童黑话（Pig Latin），这是一种拼凑的语言，世界上说英语的大部分孩子都对其熟知。在儿童黑话中，单词是通过应用下面的规则从它们对应的英语单词中构造而成：

1．如果单词中不含元音字母，不作任何翻译，这意味着儿童黑话的单词和原单词一样。

2．如果单词以元音字母开始，则翻译出的儿童黑话包括原单词加上其后缀way。

3．如果单词以辅音字母开始，提取辅音字符子串直到遇见第一个元音字母，移动收集的辅音字母到单词的结尾，然后添加后缀ay，这样就形成了翻译后的儿童黑话。

**line2piglatin将行分解成单词，而word2piglatin将单词按照规则转变。**

[PIGLATIN.cpp](./PigLatin.cpp)

```cpp
/*
 * Function: lineToPigLatin
 * Usage: string translation = lineToPigLatin(line);
 * -------------------------------------------------
 * Translates each word in the line to Pig Latin, leaving all other
 * characters unchanged.  The variable start keeps track of the index
 * position at which the current word begins.  As a special case,
 * the code sets start to -1 to indicate that the beginning of the
 * current word has not yet been encountered.
 */

string lineToPigLatin(string line) {
   string result;
   int start = -1;
   for (int i = 0; i < line.length(); i++) {
      char ch = line[i];
      if (isalpha(ch)) { // 分词的粒度是以任意非字母元素的
         if (start == -1) start = i;
      } 
      else {
         if (start >= 0) {
            result += wordToPigLatin(line.substr(start, i - start));
            start = -1;
         }
         result += ch;
      }
   }
   if (start >= 0) result += wordToPigLatin(line.substr(start));
   return result;
}
```



```cpp
/*
 * Function: wordToPigLatin
 * Usage: string translation = wordToPigLatin(word);
 * -------------------------------------------------
 * Translates a word from English to Pig Latin using the rules
 * specified in the text.  The translated word is returned as the
 * value of the function.
 */

string wordToPigLatin(string word) {
   int vp = findFirstVowel(word);
   if (vp == -1) {
      return word;
   } else if (vp == 0) {
      return word + "way";
   } else {
      string head = word.substr(0, vp);
      string tail = word.substr(vp);
      return tail + head + "ay";
   }
}


/*
 * Function: findFirstVowel
 * Usage: int k = findFirstVowel(word);
 * ------------------------------------
 * Returns the index position of the first vowel in word.  If
 * word does not contain a vowel, findFirstVowel returns -1.
 */

int findFirstVowel(string word) {
   for (int i = 0; i < word.length(); i++) {
      if (isVowel(word[i])) return i;
   }
   return -1;
}

/*
 * Function: isVowel
 * Usage: if (isVowel(ch)) . . .
 * -----------------------------
 * Returns true if the character ch is a vowel.
 */

bool isVowel(char ch) {
   switch (ch) {
    case 'A': case 'E': case 'I': case 'O': case 'U':
    case 'a': case 'e': case 'i': case 'o': case 'u':
      return true;
    default:
      return false;
   }
}

```

# Strlib.h

![image-20240131050633084](http://zcwave.oss-cn-qingdao.aliyuncs.com/image/image-20240131050633084.png)![image-20240131050645079](http://zcwave.oss-cn-qingdao.aliyuncs.com/image/image-20240131050645079.png)